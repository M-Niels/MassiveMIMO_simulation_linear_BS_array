import cmath
from math import atan
from numpy.random import rand
import numpy as np
import scipy.signal as signal
import random
import matplotlib.pyplot as plt
import scipy.special as bessel
import functions
import QPSK_generator
import plotly.express as px
import plotly.io as pio
import channel_calculation
import plotly.graph_objects as go
import datetime
import plotly
import QAM_generator

pio.renderers.default = "browser"

'''definitions'''
M = 64
message_bits = np.array([1, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1])
signal_wave = QAM_generator.create_QAM_signal(message_bits, 64)
# noise v:
# noise = np.random.normal(0, np.sqrt(0.5), (M,len(signal_wave))) + 1j * np.random.normal(0, np.sqrt(0.5), (M,len(signal_wave)))
# noise x:
noise = None
S = 1000
dM = 0.5
resolution = 0.1
titel = '--M=' + str(M) + '_S=' + str(S) + '_dM=' + str(dM) + '_K=' + str(1) + '_resolution=' + str(
    resolution) + '_noise-x__zonder_min_max '
header = '(' + datetime.datetime.now().strftime("%Y-%m-%d_%H:%M") + ')' + titel
print(header)

# place antennas (line @ x=0)
y_setup = list(range(40000 - int(dM * 100 * M / 2), 40000 - int(dM * 100 * M / 2) + int(dM * 100 * M), int(dM * 100)))
y_setup = [i * 0.010 for i in y_setup]
x_setup = list([0 for i in y_setup])
# random scatt setup
# place scatterers (random)
for i in range(S):
    x_setup.append(random.randint(100000, 700000) / 1000)
    y_setup.append(random.randint(0, 300000) / 1000)
# # place UE
# x_setup.append(450.3)
# y_setup.append(400.6)

'''fixed scatt setup'''
# x_setup.extend(
#     [281.062, 626.684, 562.62, 579.471, 208.285, 690.277, 293.243, 513.707, 507.254, 166.815, 661.411, 441.793, 693.324,
#      446.107, 388.934, 342.869, 614.232, 337.542, 574.243, 347.897, 313.528, 342.383, 333.716, 159.18, 695.068, 196.376,
#      333.714, 233.883, 122.415, 256.936, 607.621, 285.498, 177.566, 237.904, 171.847, 355.869, 247.899, 593.18, 345.595,
#      178.747, 310.219, 490.47, 185.268, 500.487, 664.966, 632.054, 437.436, 206.151, 361.217, 493.125, 211.581, 340.351,
#      403.561, 607.775, 578.967, 244.713, 345.605, 174.334, 100.064, 139.366, 244.902, 179.192, 358.482, 687.93, 120.032,
#      168.469, 597.173, 298.547, 250.987, 114.826, 480.657, 437.323, 523.365, 133.052, 413.767, 588.689, 115.112,
#      111.552, 663.742, 207.176, 353.572, 129.085, 130.503, 419.036, 268.183, 251.541, 176.038, 686.883, 505.348,
#      205.401, 684.113, 511.571, 603.329, 660.126, 670.484, 343.904, 201.54, 155.446, 412.437, 356.816, 173.43, 479.834,
#      380.809, 654.446, 530.941, 186.993, 396.005, 200.206, 136.737, 436.056, 310.574, 410.448, 689.879, 588.915,
#      151.681, 531.457, 633.965, 683.005, 699.15, 555.39, 338.356, 222.779, 665.531, 565.273, 555.803, 608.482, 143.587,
#      551.188, 465.149, 317.834, 238.234, 137.681, 314.514, 350.296, 234.525, 213.849, 201.588, 642.759, 685.903,
#      482.484, 251.624, 215.553, 687.025, 110.794, 346.406, 121.966, 523.737, 342.931, 589.571, 547.53, 346.802, 686.924,
#      140.835, 623.355, 488.29, 217.071, 425.435, 422.279, 444.634, 119.699, 692.058, 266.332, 289.173, 107.046, 133.459,
#      236.138, 417.519, 372.806, 414.709, 186.556, 685.557, 658.891, 237.243, 540.975, 440.211, 157.46, 561.903, 562.929,
#      416.696, 583.078, 232.709, 458.503, 443.881, 637.825, 208.692, 353.004, 179.736, 539.653, 136.705, 227.649,
#      202.994, 205.466, 195.673, 395.483, 539.148, 549.044, 670.215, 471.559, 161.259, 353.455, 289.194, 307.45, 212.797,
#      392.365, 496.308, 428.642, 380.254, 265.535, 675.842, 662.877, 488.479, 398.656, 149.757, 482.448, 251.566,
#      459.552, 350.937, 664.112, 650.372, 105.807, 607.333, 344.61, 624.895, 349.945, 254.798, 413.498, 114.224, 494.695,
#      675.292, 194.467, 169.103, 211.421, 425.659, 583.314, 201.038, 516.212, 581.844, 435.095, 294.425, 498.369,
#      497.206, 333.656, 143.223, 567.462, 480.547, 300.954, 185.943, 128.56, 124.841, 644.666, 244.121, 608.983, 353.688,
#      114.26, 659.702, 432.436, 530.093, 278.96, 121.881, 659.126, 138.318, 643.968, 171.75, 223.389, 433.347, 143.019,
#      347.935, 602.682, 669.198, 570.543, 244.745, 687.685, 637.24, 533.86, 383.256, 625.258, 498.024, 530.02, 188.459,
#      276.387, 286.531, 665.589, 318.15, 224.704, 541.49, 178.605, 129.706, 324.68, 645.298, 630.068, 301.298, 200.661,
#      663.624, 667.347, 690.598, 443.746, 445.961, 376.013, 410.198, 524.785, 595.524, 293.756, 621.9, 536.563, 486.674,
#      557.414, 160.888, 254.489, 257.831, 169.947, 195.181, 344.326, 288.926, 652.444, 112.758, 123.881, 309.353,
#      172.703, 490.659, 510.608, 215.304, 485.234, 305.759, 387.898, 240.646, 632.175, 518.984, 309.134, 588.222,
#      641.498, 302.828, 400.785, 569.623, 281.019, 215.165, 563.618, 328.303, 572.357, 393.191, 391.347, 120.288,
#      659.652, 310.932, 660.08, 417.169, 646.8, 167.672, 479.132, 156.422, 648.873, 312.819, 253.861, 335.565, 370.941,
#      556.67, 447.963, 398.676, 476.273, 679.023, 243.157, 203.695, 136.641, 162.938, 615.802, 683.967, 518.321, 145.05,
#      179.276, 231.073, 407.183, 460.007, 217.651, 320.322, 671.991, 524.276, 282.404, 117.414, 598.136, 119.925, 146.7,
#      171.111, 665.998, 295.722, 368.118, 181.661, 365.58, 227.131, 394.847, 513.002, 109.558, 663.735, 467.002, 337.78,
#      684.583, 656.044, 343.117, 282.315, 604.804, 603.78, 173.204, 667.57, 229.141, 215.935, 184.091, 138.719, 204.109,
#      462.324, 529.637, 511.006, 607.25, 628.11, 438.566, 341.125, 366.814, 567.288, 118.933, 420.073, 649.637, 640.129,
#      365.617, 515.928, 389.222, 199.887, 546.965, 560.831, 121.812, 297.675, 144.295, 253.249, 191.165, 509.027,
#      675.872, 619.892, 643.439, 474.109, 517.173, 698.636, 446.126, 455.2, 367.74, 173.498, 492.161, 293.452, 671.508,
#      142.297, 256.642, 315.801, 412.633, 688.751, 237.465, 395.791, 290.866, 328.062, 582.447, 473.694, 142.624,
#      350.203, 644.419, 692.014, 501.85, 189.718, 418.411, 690.001, 136.958, 558.566, 337.945, 485.725, 599.567, 666.031,
#      316.296, 263.905, 616.923, 244.275, 658.37, 638.66, 625.658, 623.387, 188.022, 514.955, 243.77, 379.573, 525.587,
#      564.949, 447.115, 273.791, 221.044, 281.356, 636.792, 575.782, 356.322, 603.811, 309.86, 178.985, 542.196, 699.827,
#      527.971, 426.112, 615.812, 286.994, 496.202, 493.473, 422.564, 378.653, 471.523, 131.545, 536.45, 348.278, 425.655,
#      680.4, 243.666, 611.644, 439.987, 595.48, 158.141, 382.443, 300.894, 332.411, 578.154, 586.847, 518.781, 387.324,
#      533.109, 147.831, 688.982, 426.605, 114.882, 457.042, 568.182, 185.232, 457.796, 189.045, 245.684, 632.01, 192.806,
#      570.613, 284.114, 270.98, 388.564, 482.826, 590.691, 178.409, 287.26, 303.269, 420.38, 154.065, 325.94, 397.835,
#      153.407, 622.059, 557.633, 190.66, 149.813, 231.978, 169.548, 236.559, 318.129, 384.697, 651.295, 639.874, 221.329,
#      300.033, 170.315, 347.317, 350.289, 498.327, 157.395, 349.4, 281.06, 506.376, 284.909, 547.806, 219.649, 632.646,
#      480.714, 142.242, 532.958, 474.065, 569.78, 126.513, 371.52, 225.045, 412.3, 697.379, 659.528, 509.195, 179.565,
#      125.846, 216.863, 326.356, 649.709, 262.332, 113.972, 685.138, 253.226, 605.626, 280.859, 549.164, 301.431,
#      263.891, 470.028, 103.297, 534.92, 392.732, 607.077, 604.512, 572.212, 445.412, 258.539, 407.927, 307.139, 117.195,
#      472.31, 505.528, 539.784, 534.451, 502.87, 168.555, 364.887, 414.581, 456.54, 444.149, 262.996, 349.179, 185.774,
#      631.001, 529.375, 656.968, 481.708, 484.888, 414.008, 124.279, 148.859, 484.622, 416.423, 523.989, 604.077,
#      117.457, 244.607, 592.6, 480.969, 596.72, 195.635, 153.577, 421.723, 338.327, 480.485, 220.466, 263.416, 484.957,
#      295.367, 197.177, 428.112, 500.145, 382.255, 135.403, 481.708, 385.318, 187.72, 421.181, 608.192, 152.749, 253.619,
#      444.221, 524.177, 563.794, 225.251, 272.882, 175.659, 206.626, 521.084, 175.077, 674.958, 303.166, 498.357,
#      408.286, 453.159, 402.46, 688.825, 128.735, 270.68, 422.76, 462.1, 311.055, 586.334, 341.001, 339.29, 457.687,
#      465.993, 397.454, 368.852, 699.564, 513.549, 215.596, 387.693, 137.64, 536.734, 440.258, 688.796, 265.897, 303.118,
#      229.878, 595.797, 312.819, 475.693, 649.837, 260.137, 617.973, 698.588, 379.282, 422.99, 408.621, 239.268, 649.922,
#      395.528, 148.887, 549.452, 653.844, 249.609, 170.341, 470.379, 613.294, 365.464, 528.313, 155.558, 521.893,
#      155.222, 481.16, 145.378, 183.122, 334.854, 176.363, 338.306, 621.053, 409.112, 298.535, 395.519, 279.91, 189.124,
#      571.674, 431.599, 496.087, 392.591, 587.669, 547.536, 110.947, 324.046, 177.738, 508.366, 260.384, 241.872,
#      308.217, 136.94, 307.369, 553.167, 554.914, 192.419, 420.415, 294.107, 217.589, 692.023, 473.032, 105.323, 606.55,
#      639.627, 435.706, 170.91, 459.022, 250.66, 501.261, 366.466, 377.171, 429.418, 564.94, 229.695, 546.64, 561.047,
#      181.901, 626.526, 147.102, 660.029, 349.311, 660.247, 430.769, 360.323, 313.614, 628.757, 311.015, 128.184,
#      415.379, 646.721, 281.951, 360.501, 290.347, 517.757, 664.794, 681.265, 565.656, 698.674, 460.602, 152.034,
#      442.409, 275.837, 135.387, 129.218, 351.624, 383.082, 645.515, 289.407, 669.774, 262.511, 498.04, 172.254, 130.168,
#      450.653, 156.621, 116.443, 161.901, 397.044, 606.848, 639.945, 183.997, 280.839, 223.443, 261.847, 220.468,
#      594.236, 568.99, 434.57, 479.659, 219.229, 404.354, 650.625, 479.509, 209.164, 460.074, 308.001, 202.479, 465.538,
#      318.002, 414.398, 207.439, 517.465, 379.924, 406.289, 147.254, 432.013, 237.42, 504.671, 348.994, 323.333, 279.067,
#      114.095, 604.383, 648.459, 280.838, 404.158, 336.924, 336.62, 108.171, 380.216, 484.792, 467.784, 265.179, 462.757,
#      197.229, 486.306, 202.772, 340.053, 672.187, 235.696, 260.696, 158.054, 658.265, 138.417, 300.293, 642.366,
#      390.303, 400.184, 222.741, 389.636, 301.409, 265.682, 104.948, 687.524, 417.769, 291.218, 552.776, 553.046,
#      578.983, 108.877, 567.856, 373.813, 424.414, 243.171, 337.415, 431.634, 647.743, 678.324, 610.266, 381.86, 380.008,
#      623.539, 171.194, 546.794, 640.408, 634.213, 599.491, 186.692, 575.07, 530.216, 689.079, 550.012, 546.853, 194.003,
#      625.962, 682.644, 273.422, 596.562, 387.375, 477.353, 608.354, 119.266, 241.196, 137.307, 667.757, 513.438,
#      338.069, 299.775, 291.435, 613.412, 116.387, 179.952, 378.876, 271.696, 415.171, 236.227, 367.065, 509.557,
#      494.745, 423.239, 586.293, 246.697, 383.296, 686.45, 185.12, 255.65, 195.638, 166.39, 173.878, 152.838, 507.591,
#      123.391, 499.618, 157.904, 577.092, 304.116, 422.64, 250.424, 696.983, 414.85, 189.478, 364.887, 466.21, 119.485,
#      412.887, 586.218, 447.74, 183.552, 677.289, 223.45, 185.949, 533.777, 447.152, 564.584, 382.712, 426.871, 669.71,
#      378.592, 238.398, 522.739, 666.389, 337.268, 339.416, 447.222, 558.713, 571.564, 591.821, 554.211, 696.286,
#      128.969, 201.883, 409.106, 588.027, 470.924, 649.973, 522.456, 544.707, 561.075, 342.033, 336.406])
# y_setup.extend(
#     [309.622, 41.497, 590.12, 607.585, 643.853, 568.515, 676.947, 337.533, 102.452, 319.196, 303.585, 36.036, 47.49,
#      306.554, 204.316, 150.153, 581.626, 177.356, 568.853, 11.763, 317.32, 522.371, 67.575, 279.964, 609.915, 379.256,
#      351.055, 78.342, 180.828, 234.483, 448.13, 493.362, 114.964, 627.848, 635.749, 673.636, 536.482, 627.144, 42.207,
#      298.907, 291.604, 43.256, 396.399, 613.853, 151.208, 520.581, 213.78, 587.97, 266.998, 6.949, 590.313, 75.494,
#      86.722, 97.891, 316.631, 335.961, 504.29, 568.34, 693.597, 43.606, 221.278, 75.126, 379.873, 388.62, 145.586,
#      594.967, 80.002, 401.744, 570.712, 33.507, 122.654, 457.233, 159.517, 435.405, 125.934, 166.519, 234.638, 453.441,
#      406.716, 292.116, 397.569, 217.853, 649.593, 4.858, 59.299, 373.233, 77.303, 313.532, 34.719, 603.315, 615.736,
#      352.164, 537.421, 28.048, 48.474, 607.895, 460.07, 321.066, 282.569, 494.39, 387.455, 258.518, 650.21, 84.92,
#      644.419, 693.725, 605.331, 337.444, 462.573, 165.631, 75.366, 454.714, 424.846, 447.722, 341.35, 625.452, 314.213,
#      33.051, 83.436, 523.636, 577.449, 660.846, 528.211, 174.652, 607.058, 124.651, 566.541, 229.936, 319.101, 306.412,
#      85.977, 587.564, 472.056, 370.043, 498.597, 64.316, 512.221, 385.441, 577.954, 215.903, 151.251, 51.253, 693.117,
#      81.005, 493.296, 611.41, 647.455, 554.668, 49.429, 406.145, 463.595, 33.528, 488.242, 674.321, 691.605, 140.373,
#      622.705, 283.802, 114.251, 434.348, 561.142, 684.95, 21.633, 564.581, 577.978, 404.883, 520.247, 136.367, 286.98,
#      412.5, 599.255, 337.11, 80.423, 294.758, 162.285, 637.777, 226.56, 191.172, 633.514, 350.562, 644.909, 366.707,
#      194.606, 37.128, 160.141, 347.429, 384.034, 200.658, 393.975, 427.263, 37.069, 691.046, 204.835, 134.603, 300.57,
#      23.004, 232.164, 447.989, 129.248, 493.83, 542.987, 78.971, 236.547, 219.346, 93.639, 231.467, 344.523, 589.362,
#      474.731, 494.777, 128.499, 239.386, 197.311, 453.567, 261.226, 604.405, 232.581, 493.139, 376.533, 351.92, 22.014,
#      242.484, 230.806, 105.438, 38.174, 457.302, 597.025, 476.049, 630.267, 445.201, 411.442, 522.127, 530.89, 410.671,
#      272.98, 644.199, 209.356, 15.205, 580.102, 80.413, 195.759, 188.185, 484.282, 241.804, 602.525, 204.729, 686.136,
#      79.258, 84.344, 497.932, 119.721, 67.345, 93.966, 105.97, 101.092, 412.535, 404.917, 656.757, 693.967, 163.579,
#      248.672, 619.807, 599.396, 197.893, 636.164, 56.374, 110.773, 86.746, 487.088, 442.434, 371.841, 303.043, 110.06,
#      282.735, 279.833, 559.13, 211.631, 26.278, 599.585, 361.187, 70.813, 513.594, 478.795, 240.045, 541.298, 84.043,
#      61.655, 640.262, 507.252, 48.218, 330.504, 585.613, 464.698, 662.56, 492.231, 519.683, 27.71, 175.15, 501.42,
#      353.157, 502.475, 254.178, 271.402, 265.131, 583.194, 517.668, 387.285, 660.632, 56.62, 125.687, 291.131, 674.06,
#      388.194, 81.442, 354.472, 432.506, 610.206, 168.861, 514.866, 344.262, 478.756, 71.052, 94.28, 540.426, 454.888,
#      202.671, 72.594, 155.99, 678.141, 63.028, 641.128, 698.145, 695.359, 282.584, 380.425, 166.224, 347.868, 654.145,
#      350.821, 662.717, 222.424, 14.992, 566.571, 437.687, 679.999, 57.275, 178.3, 168.169, 189.656, 641.014, 211.026,
#      301.612, 668.951, 614.781, 189.058, 43.39, 149.453, 496.865, 357.898, 300.394, 236.938, 174.04, 324.475, 679.098,
#      208.221, 167.84, 131.431, 242.786, 87.654, 334.525, 62.668, 123.376, 54.155, 533.718, 297.887, 247.788, 544.826,
#      223.462, 243.655, 38.212, 289.473, 81.604, 372.599, 496.048, 509.072, 448.468, 306.098, 471.42, 270.621, 300.98,
#      457.94, 635.363, 433.869, 405.093, 575.065, 7.565, 491.698, 110.209, 92.381, 29.158, 668.469, 31.275, 350.355,
#      459.198, 534.461, 417.166, 635.934, 462.82, 470.902, 631.685, 297.714, 439.96, 198.072, 287.621, 247.145, 317.915,
#      45.807, 6.941, 570.827, 617.0, 97.696, 566.353, 239.932, 342.639, 23.752, 85.596, 478.251, 182.493, 105.575,
#      329.537, 306.065, 567.311, 344.368, 435.264, 678.912, 415.861, 341.515, 609.749, 551.929, 521.07, 396.917, 209.884,
#      112.865, 295.861, 578.955, 96.445, 698.503, 448.976, 12.027, 569.104, 560.832, 396.559, 260.597, 680.248, 324.195,
#      576.07, 357.773, 338.462, 383.887, 307.084, 400.612, 113.252, 39.06, 178.65, 323.574, 11.312, 354.312, 98.134,
#      250.935, 37.389, 423.789, 216.029, 47.996, 366.295, 529.149, 104.774, 414.605, 4.272, 289.076, 92.59, 555.825,
#      171.885, 32.857, 585.654, 24.407, 646.933, 153.931, 637.848, 36.496, 529.137, 237.09, 673.122, 647.976, 100.021,
#      338.527, 221.345, 145.159, 304.875, 340.484, 538.353, 337.721, 526.58, 280.334, 283.386, 40.645, 49.784, 164.194,
#      565.714, 290.946, 619.681, 45.835, 192.779, 38.954, 121.185, 537.378, 674.473, 423.542, 298.244, 267.277, 458.909,
#      370.037, 39.377, 411.748, 585.923, 182.344, 39.074, 649.597, 362.767, 10.046, 196.579, 411.047, 144.845, 158.578,
#      646.17, 388.689, 113.203, 407.26, 333.547, 282.736, 64.983, 665.837, 169.483, 499.219, 391.283, 259.973, 186.096,
#      309.208, 330.081, 396.974, 82.97, 62.766, 175.165, 694.227, 328.964, 512.443, 649.051, 16.565, 432.019, 457.647,
#      610.419, 598.695, 664.526, 123.214, 344.362, 607.726, 504.793, 216.551, 358.169, 421.361, 144.199, 528.732,
#      490.922, 293.244, 632.62, 284.285, 222.411, 547.978, 589.583, 670.225, 674.441, 95.152, 403.159, 567.721, 573.905,
#      78.16, 239.605, 647.124, 466.818, 690.191, 42.073, 580.151, 141.267, 484.74, 337.831, 354.935, 660.176, 402.942,
#      0.823, 307.218, 673.443, 647.875, 69.407, 448.994, 38.418, 340.572, 159.05, 427.564, 183.438, 450.794, 363.89,
#      409.875, 529.659, 155.648, 344.385, 619.392, 165.511, 458.146, 646.35, 124.048, 365.984, 642.58, 80.513, 84.307,
#      298.916, 445.391, 574.708, 309.369, 264.77, 254.152, 682.015, 295.187, 686.607, 524.786, 505.424, 186.012, 498.718,
#      439.828, 602.156, 347.077, 193.546, 619.794, 521.621, 424.961, 453.926, 653.087, 669.602, 32.143, 479.123, 502.938,
#      332.998, 179.664, 554.335, 249.966, 510.899, 68.444, 534.879, 6.645, 203.481, 589.658, 325.197, 533.249, 366.188,
#      506.252, 675.632, 477.442, 458.908, 19.96, 498.681, 560.489, 42.001, 688.565, 629.939, 222.731, 274.854, 632.72,
#      519.49, 43.005, 689.368, 194.466, 362.994, 78.006, 203.299, 657.146, 181.224, 548.652, 28.255, 272.666, 487.909,
#      488.62, 239.265, 336.935, 695.498, 142.118, 31.022, 55.625, 690.277, 131.839, 249.052, 435.42, 153.525, 656.58,
#      373.454, 291.346, 261.675, 480.192, 15.008, 209.864, 420.3, 514.783, 651.124, 308.105, 547.887, 516.159, 207.111,
#      436.629, 604.441, 57.636, 625.214, 405.799, 463.403, 131.648, 305.976, 278.94, 592.752, 687.204, 52.932, 291.926,
#      461.642, 218.701, 5.834, 27.296, 245.443, 358.228, 285.634, 305.65, 603.391, 551.838, 698.939, 485.476, 529.542,
#      35.537, 454.491, 396.062, 1.344, 544.507, 390.86, 384.439, 538.664, 195.937, 156.389, 355.236, 473.471, 241.9,
#      165.601, 378.713, 291.006, 116.014, 588.006, 528.262, 541.483, 125.27, 305.821, 308.729, 259.972, 268.517, 575.361,
#      226.386, 613.002, 94.523, 74.819, 581.488, 517.508, 533.247, 201.738, 43.996, 201.82, 442.156, 403.544, 207.84,
#      109.754, 491.323, 91.581, 380.175, 184.811, 370.887, 259.533, 191.208, 162.988, 485.357, 687.087, 127.791, 83.409,
#      544.321, 59.404, 564.872, 476.233, 312.539, 237.956, 543.698, 620.556, 517.673, 382.196, 445.409, 478.536, 378.173,
#      80.432, 386.597, 9.732, 91.632, 217.485, 644.892, 554.815, 612.976, 501.096, 586.205, 644.949, 102.678, 275.479,
#      624.058, 404.256, 250.488, 529.405, 599.294, 637.772, 672.461, 209.135, 403.312, 681.965, 380.491, 159.154,
#      419.056, 289.686, 352.147, 474.58, 58.547, 289.854, 244.524, 128.847, 173.251, 185.442, 606.39, 107.21, 445.015,
#      255.805, 108.968, 494.214, 399.965, 533.867, 14.504, 649.659, 387.713, 226.146, 543.171, 489.651, 192.362, 268.46,
#      683.196, 525.37, 283.302, 324.795, 696.408, 432.927, 265.568, 246.452, 264.809, 620.252, 255.75, 394.45, 33.115,
#      391.264, 500.815, 657.721, 632.315, 263.093, 361.764, 62.391, 677.645, 397.825, 458.535, 419.069, 626.353, 354.065,
#      436.867, 29.761, 75.764, 337.199, 639.456, 477.028, 100.372, 158.105, 509.405, 374.895, 123.904, 48.841, 53.11,
#      78.189, 607.801, 552.845, 15.678, 307.098, 476.764, 364.347, 656.266, 79.65, 108.183, 115.455, 277.506, 396.329,
#      399.457, 64.591, 311.779, 478.56, 9.585, 21.339, 432.088, 134.091, 137.516, 335.053, 48.239, 304.44, 82.151,
#      218.047, 512.65, 76.545, 501.101, 53.525, 165.339, 627.804, 598.659, 200.989, 324.99, 290.437, 224.251, 340.854,
#      644.502, 515.362, 285.878, 537.433, 556.724, 97.402, 302.995, 202.125, 262.254, 437.045, 354.286, 51.652, 491.208,
#      108.86, 447.617, 245.651, 209.802, 389.767, 278.763, 249.467, 305.051, 73.656, 249.431, 271.923, 107.654, 270.681,
#      544.164, 87.011, 536.9, 678.882, 114.048, 352.617, 618.448, 465.524, 69.472, 191.628, 562.259, 91.481, 61.164,
#      423.114, 89.508, 531.427, 430.307, 43.133, 308.88, 195.97, 520.081, 373.642, 649.13, 426.715, 281.475, 65.61,
#      133.215, 528.543, 585.684, 95.79, 509.569, 621.299, 239.6, 133.506, 254.233, 1.075, 558.4, 630.741, 170.124,
#      114.015])

'''fixed UE setup'''
x_setup.extend([184.75, 362.147, 200.3])
y_setup.extend([148.16, 68.29, 10.6])

'''plotting setup...'''
plt.scatter(x_setup[:-1], y_setup[:-1])
plt.scatter(x_setup[-1], y_setup[-1], color='red')
plt.title(header)
plt.show()

# calculate distances (a: BS -> scatt; b: scatt -> UE)
distances_a = []  # staat vast, dus moet niet op voorhand gegenereerd worden
for s in range(S):
    z = s + 2
    distances_a_i = []
    for m in range(M):
        distances_a_i.append(np.sqrt((x_setup[m] - x_setup[-z]) ** 2 + (y_setup[m] - y_setup[-z]) ** 2))
    distances_a.append(distances_a_i)
# calc channel vector for UE @original place
h = []
for m in range(M):
    phaseshifts = []
    for s in range(S):
        dist = distances_a[s][m] + np.sqrt((x_setup[-1] - x_setup[-(s + 2)]) ** 2 + (y_setup[-1] - y_setup[-(s + 2)]) ** 2)
        phaseshifts.append(np.exp(1j * 2 * np.pi * (dist - int(dist))) / np.exp(np.pi))  # energieschaling is hier 1 op wortel M
    h.append(sum(phaseshifts))
h = np.array(h)
wH = h.conj().T

'''raster'''
# y1 = list(range(-100, 105, 10))
# x1 = list(range(-100, 105, 10))
# y2 = list(range(-500, -100, 10))
# x2 = list(range(-500, -100, 10))
# y3 = list(range(110, 510, 10))
# x3 = list(range(110, 510, 10))
# y2.extend(y1)
# y2.extend(y3)
# x2.extend(x1)
# x2.extend(x3)
# y = [item * resolution / 10 + y_setup[-1] for item in y2]
# x = [item * resolution / 10 + x_setup[-1] for item in x2]
'''centrale plaats antenne: x[int(len(x)/2)], y[int(len(y)/2)]'''
# plt.scatter(x, y)
# plt.scatter(x_setup[-1], y_setup[-1], color='red')
# plt.title(header)
# plt.show()

# ampl = np.zeros(shape=(len(x), len(y)))
# for a in range(len(x)):
#     for b in range(len(y)):
#         hdx = []
#         for m in range(M):
#             phaseshifts = []
#             for s in range(S):
#                 dist = distances_a[s][m] + np.sqrt((x[a] - x_setup[-(s + 2)]) ** 2 + (y[b] - y_setup[-(s + 2)]) ** 2)
#                 phaseshifts.append(np.exp(1j * 2 * np.pi * (dist % 1)))  # energieschaling is hier 1 op wortel M
#             hdx.append(sum(phaseshifts) / np.exp(np.pi))
#         ampl[a, b] = channel_calculation.calc_signal(signal_wave, M, hdx=hdx, weights_hermitian_wH=wH, calculation='valdB',
#                                                      noise=noise)
#     print(a)

dfghjk = np.fft.ifft(abs(wH))
dfghjk = np.append(dfghjk, dfghjk[0])
lkjhgf = np.linspace(0, 2*np.pi, M)
lkjhgf = np.append(lkjhgf, lkjhgf[0])
plt.polar(lkjhgf, abs(dfghjk))
plt.title(str(M))
plt.show()

dfghjk = np.fft.fft(abs(wH))
kliugfc = np.linspace(0,2*np.pi, M)
plt.plot(kliugfc, abs(dfghjk ))
plt.title(str(M))
plt.show()
